{"version":3,"file":"10.chunk.js","sources":["webpack:///./wechat-react/mine/containers/business-payment-takeincome/components/form-item/index.js","webpack:///./wechat-react/mine/containers/business-payment-takeincome/index.js"],"sourcesContent":["import React from 'react';\r\n\r\nexport default function(props) {\r\n    return (\r\n        <div className=\"form-item\">\r\n            <div className=\"title\">\r\n                {props.title}：\r\n            </div>\r\n\r\n            <div className=\"input\">\r\n                <input type=\"text\" disabled={props.disabled} placeholder={props.placeholder} value={props.value} onChange={props.onChange}/>\r\n            </div>\r\n        </div>      \r\n    )\r\n}","import React, { Component } from \"react\";\r\n\r\nimport { autobind } from \"core-decorators\";\r\nimport Page from \"components/page\";\r\nimport FormItem from \"./components/form-item\";\r\nimport { Confirm } from \"components/dialog\";\r\n\r\nimport { connect } from \"react-redux\";\r\nimport { uploadImage, getUserInfo } from \"../../../actions/common\";\r\nimport {\r\n    getPubToPubMessage,\r\n    commitApply\r\n} from \"../../actions/business-payment-takeincome\";\r\n\r\n@autobind\r\nclass BusinessPaymentTakeIncome extends Component {\r\n    state = {\r\n        applyAmount: \"\",\r\n        promiseLetterUrl: \"\",\r\n        isFocus: false\r\n    };\r\n\r\n    refs = {\r\n        promiseDialog: null\r\n    };\r\n\r\n    data = {\r\n        // 水印图片地址\r\n        watermark:\r\n            \"https://img.qlchat.com/qlLive/business/B7BQHAYM-8L97-V664-1554953766693-S2L17XQJJJ7X.png\"\r\n    };\r\n\r\n    async componentDidMount() {\r\n        this.initStsInfo();\r\n        await this.props.getUserInfo();\r\n        const res = await this.props.getPubToPubMessage({\r\n            liveId: this.props.location.query[\"liveId\"],\r\n            userId: this.props.userInfo.user.userId\r\n        });\r\n    }\r\n\r\n    initStsInfo() {\r\n        const script = document.createElement(\"script\");\r\n        script.src =\r\n            \"//static.qianliaowang.com/frontend/rs/lib/aliyun-oss-sdk.min.js\";\r\n        document.body.appendChild(script);\r\n    }\r\n\r\n    changeHandler(e, name) {\r\n        const val = e.target.value;\r\n        this.setState({ [name]: val });\r\n    }\r\n\r\n    showPromiseDialog() {\r\n        this.promiseDialog.show();\r\n    }\r\n\r\n    hidePromiseDialog() {\r\n        this.promiseDialog.hide();\r\n    }\r\n\r\n    handleAmountChange(e) {\r\n        const val = e.target.value;\r\n        // const fee  = this.getFee(val);\r\n        // console.log(';FUCK', fee)\r\n\r\n        this.setState({\r\n            applyAmount: val\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 计算手续费率\r\n     * @param {string} amount 申请额度\r\n     */\r\n    getFeeText(amount) {\r\n        if (amount.length <= 0) return;\r\n        const money = Number(amount);\r\n        if (isNaN(money)) {\r\n            return <p className=\"text moneyrate\">请输入2~50万范围的数字</p>;\r\n        }\r\n        if (money >= 20000 && money <= 200000) {\r\n            const fee = money - money * 0.05;\r\n            return (\r\n                <p className=\"text moneyrate\">\r\n                    本次提现的服务费率为<span>5%</span>\r\n                    ，扣除后提现到账金额为\r\n                    <span>{fee}</span>元\r\n                </p>\r\n            );\r\n        } else if (money > 200000 && money <= 500000) {\r\n            const fee = money - money * 0.03;\r\n            return (\r\n                <p className=\"text moneyrate\">\r\n                    本次提现的服务费率为<span>3%</span>\r\n                    ，扣除后提现到账金额为\r\n                    <span>{fee}</span>元\r\n                </p>\r\n            );\r\n        } else {\r\n            return <p className=\"text moneyrate\">请输入2~50万范围的数字</p>;\r\n        }\r\n    }\r\n\r\n    async submit() {\r\n        const money = Number(this.state.applyAmount);\r\n        if (this.state.applyAmount.length <= 0) {\r\n            window && window.toast(\"请先输入申请金额\", 3000);\r\n            return;\r\n        }\r\n        if (this.state.promiseLetterUrl.length <= 0) {\r\n            window && window.toast(\"请先上传承诺函\", 3000);\r\n            return;\r\n        }\r\n        if (isNaN(money) || money < 20000 || money > 500000) {\r\n            window && window.toast(\"请输入2~50万范围的提现金额\", 3000);\r\n            return;\r\n        }\r\n        this.props.commitApply({\r\n            money: this.state.applyAmount,\r\n            liveId: this.props.location.query[\"liveId\"],\r\n            userId: this.props.userInfo.user.userId,\r\n            commitmentLetter: this.state.promiseLetterUrl\r\n        });\r\n    }\r\n\r\n    async uploadImage(e) {\r\n        const file = e.target.files[0];\r\n        let backgroundUrl;\r\n        try {\r\n            const watermarkFile = await this.addImageWatermark(\r\n                file,\r\n                this.data.watermark\r\n            );\r\n            backgroundUrl = await this.props.uploadImage(\r\n                watermarkFile,\r\n                \"topicBackground\"\r\n            );\r\n            if (backgroundUrl) {\r\n                this.setState({\r\n                    promiseLetterUrl: backgroundUrl\r\n                });\r\n            }\r\n        } catch (error) {}\r\n    }\r\n\r\n    /**\r\n     * 给图片添加居中的图片水印\r\n     * @param {File} file HTML5 File对象\r\n     * @param {String} watermarkImageUrl 水印图片的地址\r\n     */\r\n    addImageWatermark(file, watermarkImageUrl) {\r\n        const reader = new FileReader();\r\n        const sourceImage = new Image();\r\n        const canvas = document.createElement(\"canvas\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        return new Promise((resolve, reject) => {\r\n            try {\r\n                reader.onload = event => {\r\n                    sourceImage.onload = () => {\r\n                        canvas.width = sourceImage.width;\r\n                        canvas.height = sourceImage.height;\r\n                        ctx.drawImage(\r\n                            sourceImage,\r\n                            0,\r\n                            0,\r\n                            sourceImage.width,\r\n                            sourceImage.height\r\n                        );\r\n                        const watermarkImage = new Image();\r\n                        watermarkImage.crossOrigin = \"anonymous\";\r\n                        watermarkImage.src = `/api/wechat/image-proxy?url=${watermarkImageUrl}`;\r\n                        watermarkImage.onload = () => {\r\n                            const watermarkImageWidth = watermarkImage.width;\r\n                            const watermarkImageHeight = watermarkImage.height;\r\n                            ctx.drawImage(\r\n                                watermarkImage,\r\n                                0,\r\n                                0,\r\n                                watermarkImageWidth,\r\n                                watermarkImageHeight,\r\n                                0,\r\n                                0,\r\n                                canvas.width,\r\n                                (canvas.width * watermarkImageHeight) /\r\n                                    watermarkImageWidth\r\n                            );\r\n                            const blob = this.dataURLtoBlob(\r\n                                canvas.toDataURL(\"image/jpeg\")\r\n                            );\r\n                            const resultFile = new File([blob], \"tmp.jpg\", {\r\n                                type: \"image/jpeg\"\r\n                            });\r\n                            resolve(resultFile);\r\n                        };\r\n                    };\r\n                    sourceImage.src = event.target.result;\r\n                };\r\n                reader.readAsDataURL(file);\r\n            } catch (err) {\r\n                console.error(\"图片添加水印失败！\");\r\n            }\r\n        });\r\n    }\r\n\r\n    dataURLtoBlob(dataurl) {\r\n        var arr = dataurl.split(\",\"),\r\n            mime = arr[0].match(/:(.*?);/)[1],\r\n            bstr = atob(arr[1]),\r\n            n = bstr.length,\r\n            u8arr = new Uint8Array(n);\r\n        while (n--) {\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], { type: mime });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Page\r\n                title=\"公对公打款提现\"\r\n                className=\"business-payment-takeincome\"\r\n            >\r\n                <div className=\"scroll\">\r\n                    <form className=\"form\">\r\n                        <FormItem\r\n                            title=\"申请金额\"\r\n                            placeholder=\"请输入金额\"\r\n                            value={this.state.applyAmount}\r\n                            onChange={this.handleAmountChange}\r\n                        />\r\n                        {this.getFeeText(this.state.applyAmount)}\r\n                        <FormItem\r\n                            title=\"开户行\"\r\n                            disabled={true}\r\n                            placeholder=\"请输入开户银行\"\r\n                            value={this.props.openBank}\r\n                            onChange={e => {\r\n                                this.changeHandler(e, \"accountBank\");\r\n                            }}\r\n                        />\r\n                        <FormItem\r\n                            title=\"收款账号\"\r\n                            disabled={true}\r\n                            placeholder=\"请输入收款账号\"\r\n                            value={this.props.accountNo}\r\n                            onChange={e => {\r\n                                this.changeHandler(e, \"accountNumber\");\r\n                            }}\r\n                        />\r\n                        <FormItem\r\n                            title=\"户名\"\r\n                            disabled={true}\r\n                            placeholder=\"请输入户名\"\r\n                            value={this.props.accountName}\r\n                            onChange={e => {\r\n                                this.changeHandler(e, \"accountName\");\r\n                            }}\r\n                        />\r\n                    </form>\r\n\r\n                    <div className=\"upload-box\">\r\n                        <div className=\"header\">\r\n                            上传承诺函\r\n                            <span\r\n                                className=\"upload-tip\"\r\n                                onClick={this.showPromiseDialog}\r\n                            />\r\n                            <a\r\n                                className=\"download-btn\"\r\n                                href=\"https://static.qianliaowang.com/frontend/rs/doc/大额提款承诺书-ytxjeyfw.doc\"\r\n                                download=\"大额提款承诺书.doc\"\r\n                            >\r\n                                下载模板\r\n                            </a>\r\n                        </div>\r\n                        <div className=\"content\">\r\n                            <div\r\n                                className=\"upload-img-wrap\"\r\n                                style={\r\n                                    this.state.promiseLetterUrl.length > 0\r\n                                        ? {\r\n                                              background: `url(${\r\n                                                  this.state.promiseLetterUrl\r\n                                              }) 0% 0% / cover no-repeat`\r\n                                          }\r\n                                        : {}\r\n                                }\r\n                            >\r\n                                {this.state.promiseLetterUrl.length <= 0 && (\r\n                                    <div className=\"upload-empty\">\r\n                                        <span className=\"icon-upload\" />\r\n                                        <p className=\"upload-title\">\r\n                                            上传承诺函图片\r\n                                        </p>\r\n                                        <p className=\"upload-desc\">\r\n                                            请务必下载模板打印后，加盖企业公章并手写签字，\r\n                                            扫描后上传(支持jpg、jpeg、bmp、png\r\n                                            大小不超5M)\r\n                                        </p>\r\n                                    </div>\r\n                                )}\r\n                                <input\r\n                                    type=\"file\"\r\n                                    className=\"file\"\r\n                                    accept=\"image/jpg,image/jpeg,image/png,image/gif,image/bmp\"\r\n                                    onChange={this.uploadImage}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"desc-box\">\r\n                        <p className=\"text title\">公对公提现说明：</p>\r\n                        <p className=\"text\">\r\n                            1、 从2019年7月1日，对公提现金额范围2~50万。其中\r\n                            <span>2万~20万 (包含20万)</span>提现服务费\r\n                            <span>5%，20万~50万(包含50万)</span>提现服务费\r\n                            <span>3%</span>\r\n                        </p>\r\n                        <p className=\"text\">\r\n                            2、审核通过后<span>10~15</span>\r\n                            个工作日内可到账，节假日顺延，请在提现明细里查看进度\r\n                        </p>\r\n                        <p className=\"text\">\r\n                            3、提现申请需先邮寄纸质<span>【承诺函】</span>\r\n                            到千聊，否则将影响进一步提现。\r\n                            <span>\r\n                                (邮寄地址：广东省广州市天河区远洋创意园棠下街道棠东东路5号沐思科技有限公司(干聊)财务部-对公打款\r\n                                电话：020-88525535)\r\n                            </span>\r\n                        </p>\r\n                        <p className=\"text\">\r\n                            4、如有疑问，请关注<span>【千聊知识店铺】</span>\r\n                            并回复关键词“<span>企业提现</span>\r\n                            \"，我们将第一时间回复您\r\n                        </p>\r\n                        <p className=\"text\">\r\n                            5、\r\n                            <a\r\n                                className=\"link\"\r\n                                href={`/wechat/page/mine/takeincome-record?liveId=${\r\n                                    this.props.location.query[\"liveId\"]\r\n                                }`}\r\n                            >\r\n                                点击查看对公提现进度>>\r\n                            </a>\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bottom-btn-wrap\">\r\n                    <div className=\"bottom-btn\" onClick={this.submit}>\r\n                        提交申请\r\n                    </div>\r\n                </div>\r\n\r\n                <Confirm\r\n                    className=\"promise-dialog\"\r\n                    title=\"承诺函说明\"\r\n                    buttons=\"cancel\"\r\n                    cancelText=\"我知道了\"\r\n                    ref={dom => {\r\n                        this.promiseDialog = dom;\r\n                    }}\r\n                >\r\n                    <p className=\"content\">\r\n                        <p className=\"promise-item\">\r\n                            <span className=\"order\">1、</span>\r\n                            <span className=\"content-text\">\r\n                                在企业对公提现时，需提交承诺函;\r\n                            </span>\r\n                        </p>\r\n\r\n                        <p className=\"promise-item\">\r\n                            <span className=\"order\">2、</span>\r\n                            <span className=\"content-text\">\r\n                                承诺函是直播间对公提现及完税证明时需用到的证明材料;\r\n                            </span>\r\n                        </p>\r\n\r\n                        <p className=\"promise-item\">\r\n                            <span className=\"order\">3、</span>\r\n                            <span className=\"content-text\">\r\n                                每次对公提现，由于提现金额可能不一致，需按照承诺函上的要求，按照实际提现信息填写;\r\n                            </span>\r\n                        </p>\r\n\r\n                        <p className=\"promise-item\">\r\n                            <span className=\"order\">4、</span>\r\n                            <span className=\"content-text\">\r\n                                请先下载承诺函模板，按照模板要去填写。\r\n                            </span>\r\n                        </p>\r\n\r\n                        <p className=\"promise-item\">\r\n                            <span className=\"order\">5、</span>\r\n                            <span className=\"content-text\">\r\n                                关于承诺函及提现流程的使用说明，{\" \"}\r\n                                <a href=\"https://w.url.cn/s/AVMj8DA\">\r\n                                    点击查看教程>>\r\n                                </a>\r\n                            </span>\r\n                        </p>\r\n                    </p>\r\n                </Confirm>\r\n            </Page>\r\n        );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n    return {\r\n        userInfo: state.common.userInfo,\r\n        accountName: state.businessPaymentTakeincome.accountName,\r\n        accountNo: state.businessPaymentTakeincome.accountNo,\r\n        openBank: state.businessPaymentTakeincome.openBank\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    uploadImage,\r\n    getUserInfo,\r\n    getPubToPubMessage,\r\n    commitApply\r\n};\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(BusinessPaymentTakeIncome);\r\n"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;;;AACA;AACA;AACA;AAAA;AACA;AAAA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;;;;;;;;;;;;;;;;ACdA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AADA;AACA;AAGA;AACA;AACA;AAFA;AACA;;;;;;;;;;;;;;;AAMA;;AACA;AACA;;;AAAA;AACA;AACA;AAFA;AACA;;AADA;AACA;;;;;;;;;;;;;;;;;AAKA;AACA;AACA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AADA;AAGA;AAEA;;;;;;;AAIA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAMA;AACA;AACA;AAAA;AACA;AAAA;AAMA;AACA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;AAGA;AACA;AAAA;;;;;AACA;;;;AAGA;;;;;AACA;;;;AAGA;;;;;AACA;;;;AAGA;AACA;AACA;AACA;AACA;AAJA;AACA;;;;;;;;;;;;;;;;;;;;AAOA;;;;;;AACA;;;AAGA;AACA;;AADA;;AAIA;AACA;;AADA;AACA;AAGA;AACA;AACA;AADA;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;;AAGA;;;;;;;;AAKA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAWA;AACA;AAEA;AACA;AADA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;;;AAEA;AAAA;AACA;AAAA;AAEA;AACA;AAFA;AAIA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAWA;AAAA;AACA;AAAA;AAGA;AACA;AAFA;AAKA;AACA;AACA;AAHA;AAQA;AAAA;AAEA;AACA;AAGA;AADA;AAJA;AAaA;AAAA;AACA;AAAA;AACA;AAAA;AAGA;AAAA;AAQA;AACA;AACA;AACA;AAJA;AAUA;AAAA;AACA;AAAA;AACA;AAAA;AAMA;AAAA;AAIA;AAAA;AAQA;AAAA;AAKA;AAAA;AAGA;AACA;AAFA;AAYA;AAAA;AACA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAKA;AAAA;AACA;AAAA;AACA;AAAA;AAKA;AAAA;AACA;AAAA;AACA;AAAA;AAKA;AAAA;AACA;AAAA;AACA;AAAA;AAKA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AASA;;;;AAzYA;AACA;AA2YA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;;;;;A","sourceRoot":""}